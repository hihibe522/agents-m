---
name: commit-code-review
description: Use when user provides a commit ID or hash and requests code review, cr, or asks to review changes
---

# Commit Code Review

## Overview

快速、系統性地對指定 commit 進行 code review。確保涵蓋所有關鍵檢查項目並使用一致的輸出格式。

## When to Use

**使用時機**:

- 使用者貼上 commit ID/hash
- 提到 "cr"、"code review"、"review"、"檢視"

**不使用時機**:

- 要 review 整個 PR（使用其他 skill）
- 要 review 工作目錄的未提交變更（用 git diff）

## Implementation

### Step 1: 獲取 Commit 異動

```bash
git show <commit-id>
```

如果 commit 不存在,回報：「Commit ID 不存在，請確認後再試」

### Step 2: 系統性 Review

**CRITICAL: 必須明確報告所有 5 個檢查項目的結果**

即使沒有發現問題，也要明確說明「✅ [檢查項目]: 未發現明顯問題」，讓使用者確認所有項目都有被檢查。

按照以下 5 個檢查項目逐一檢視：

**1. 程式邏輯正確性**

- 邏輯是否正確？
- 邊界條件是否處理？
- 錯誤處理是否完整？

**2. 安全性問題**

- SQL Injection 風險？
- XSS 漏洞？
- 敏感資料暴露？
- 輸入驗證不足？

**3. 效能問題**

- N+1 查詢？
- 不必要的迴圈？
- 記憶體洩漏風險？
- 大量資料處理未分頁？

**4. 程式碼可讀性**

- 命名是否清楚？
- 函數是否過長？
- 巢狀層級是否過深？
- 註解是否必要且清楚？

**5. 風格一致性**

- 與專案現有風格是否一致？
- 格式是否符合規範？
- 檔案結構是否合理？

### Step 3: 輸出 Review 結果

使用以下優先級標記：

- 🔴 **Critical**: 必須修正的嚴重問題（安全性、邏輯錯誤）
- 🟡 **建議**: 應該改進的問題（效能、可讀性）
- ✅ **做得好**: 值得稱讚的地方

## Output Format

```markdown
## Code Review for <commit-id>

**Commit**: <commit message>

---

### 🔴 Critical: [問題標題]

**檔案**: `path/to/file.ts:line`
**問題**: [具體描述問題]
**建議**: [如何修正]

**範例**:
```typescript
// 修改前
[問題程式碼]

// 修改後
[改進的程式碼]
```

---

### 🟡 建議: [建議標題]

**檔案**: `path/to/file.ts:line`
**說明**: [為何建議改進]

**範例**:

```typescript
// 目前
[現有程式碼]

// 建議
[改進的程式碼]
```

---

### ✅ 做得好: [稱讚標題]

[說明為何這部分做得好]

---

### ✅ 程式邏輯正確性: 未發現明顯問題

檢查了邊界條件處理和錯誤處理，未發現邏輯錯誤。

---

### ✅ 安全性檢查: 未發現明顯問題

檢查了 SQL Injection、XSS、敏感資料暴露等常見安全問題，未發現明顯風險。

---

### ✅ 效能檢查: 未發現明顯問題

檢查了 N+1 查詢、不必要的迴圈等效能問題，未發現明顯瓶頸。

---

### 📋 總結

**優點**:

- [列出優點]

**需要改進**:

- [列出需改進項目]

**整體評價**: [簡短總結]

```

## Common Mistakes

### ❌ 錯誤 1: 沒有系統性檢查所有項目

**問題**: 只看到明顯的問題，遺漏安全性或效能問題

**解法**: 強制按照 5 個檢查項目逐一檢視

### ❌ 錯誤 2: 優先級標記不一致

**問題**: 使用不同的標記符號或等級

**解法**: 嚴格使用 🔴 Critical、🟡 建議、✅ 做得好

### ❌ 錯誤 3: 建議太抽象

**問題**: 只說「這裡可以改進」但沒有具體建議

**解法**: 每個建議都要附上具體的程式碼範例

### ❌ 錯誤 4: 忽略大型 Commit

**問題**: 看到 commit 很大就只檢查部分檔案

**解法**: 即使 commit 很大，也要全部檢視

### ❌ 錯誤 5: 遺漏未發現問題的檢查項目說明

**問題**: 只報告有問題的地方，沒有明確說明哪些項目檢查過但沒問題

**解法**: 即使沒有發現問題，也要明確寫出「✅ [檢查項目]: 未發現明顯問題」
